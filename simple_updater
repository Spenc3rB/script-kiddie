#!/usr/bin/env bash -e

# Variables
REPO_URL="https://github.com/yourusername/yourrepository.git"
CLONE_DIR="$HOME/repository_clone"
TARGET_DIR="$1"
BACKUP_DIR="$HOME/backup_$(date +%Y%m%d%H%M%S)"

# Clone the repository if not already there
if [ ! -d "$CLONE_DIR" ]; then
    git clone "$REPO_URL" "$CLONE_DIR"
fi

# Navigate to the repository directory
cd "$CLONE_DIR" || exit

# Fetch the latest changes
git fetch origin
git reset --hard origin/main

# Check for differences
if ! diff -r "$CLONE_DIR" "$TARGET_DIR"; then
    # Backup the current contents of the target directory
    mkdir -p "$BACKUP_DIR"
    cp -r "$TARGET_DIR"/* "$BACKUP_DIR"

    # Copy the contents of the main branch to the target directory
    cp -r "$CLONE_DIR"/* "$TARGET_DIR"
fi